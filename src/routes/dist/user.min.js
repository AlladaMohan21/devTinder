"use strict";var express=require("express"),userRouter=express.Router(),User=require("../models/user"),_require=require("../middlewares/auth"),userAuth=_require.userAuth,ConnectionRequest=require("../models/connectionRequest"),USER_SAFE_DATA="firstName lastName photoUrl age gender about skills";userRouter.get("/user/requests/received",userAuth,function(r,t){var s,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.user,e.next=4,regeneratorRuntime.awrap(ConnectionRequest.find({toUserId:s._id,status:"interested"}).populate("fromUserId",USER_SAFE_DATA));case 4:n=e.sent,t.json({message:"Data fetched successfully",data:n}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r.statusCode(400).send("ERROR: "+e.t0.message);case 11:case"end":return e.stop()}},null,null,[[0,8]])}),userRouter.get("/user/connections",userAuth,function(r,t){var s,n,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.user,e.next=4,regeneratorRuntime.awrap(ConnectionRequest.find({$or:[{toUserId:s._id,status:"accepted"},{fromUserId:s._id,status:"accepted"}]}).populate("fromUserId",USER_SAFE_DATA).populate("toUserId",USER_SAFE_DATA));case 4:n=e.sent,u=n.map(function(e){return e.fromUserId._id.toString()===s._id.toString()?e.toUserId:e.fromUserId}),t.json({data:u}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t.status(400).send({message:e.t0.message});case 12:case"end":return e.stop()}},null,null,[[0,9]])}),userRouter.get("/feed",userAuth,function(r,t){var s,n,u,a,o,i,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.user,n=parseInt(r.query.page)||1,u=parseInt(r.query.limit)||10,a=(n-1)*(u=50<u?50:u),e.next=8,regeneratorRuntime.awrap(ConnectionRequest.find({$or:[{toUserId:s._id},{fromUserId:s._id}]}).select("fromUserId toUserId"));case 8:return o=e.sent,i=new Set,o.forEach(function(e){i.add(e.fromUserId),i.add(e.toUserId)}),e.next=13,regeneratorRuntime.awrap(User.find({$and:[{_id:{$nin:Array.from(i)}},{_id:{$ne:s._id}}]}).select(USER_SAFE_DATA).skip(a).limit(u));case 13:c=e.sent,t.json({data:c}),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),t.status(400).send("ERROR"+e.t0.message);case 20:case"end":return e.stop()}},null,null,[[0,17]])}),module.exports=userRouter;
//# sourceMappingURL=user.min.js.map
