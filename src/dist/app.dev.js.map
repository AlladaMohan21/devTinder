{"version":3,"sources":["app.js"],"names":["express","require","connectDB","app","User","validationDatabase","bcrypt","cookieParser","jwt","use","json","post","req","res","body","firstName","lastName","emailId","password","findOne","existingUser","status","send","hash","validatePass","console","log","user","save","runValidators","code","message","Error","compare","isPasswordValid","sign","_id","token","cookie","error","get","cookies","verify","decodedMessage","findById","userId","userEmail","find","users","findByIdAndDelete","patch","params","data","ALLOWED_UPDATES","isUpdateAllowed","Object","keys","every","k","includes","skills","length","findByIdAndUpdate","returnDocument","then","listen","err"],"mappings":"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","sourcesContent":["const express = require(\"express\");\r\nconst connectDB = require(\"./config/database\");\r\nconst app = express();\r\nconst User = require(\"./models/user\");\r\nconst {validationDatabase}=require(\"./utils/validation\")\r\nconst bcrypt=require(\"bcrypt\");\r\nconst cookieParser=require(\"cookie-parser\");\r\nconst jwt=require(\"jsonwebtoken\");\r\n\r\napp.use(express.json());\r\napp.use(cookieParser())\r\n\r\napp.post(\"/signup\", async (req, res) => {\r\n//validate user \r\nvalidationDatabase(req);\r\n\r\n//encrypt password\r\nconst{firstName,lastName,emailId,password}=req.body;\r\n  const existingUser = await User.findOne({ emailId });\r\n    if (existingUser) {\r\n      return res.status(400).send(\"Email already exists\");\r\n    }\r\nconst validatePass=await bcrypt.hash(password,10);\r\nconsole.log(validatePass);\r\n  //   Creating a new instance of the User model\r\n  const user = new User({\r\n    firstName,\r\n    lastName,\r\n    password:validatePass,\r\n    emailId\r\n  });\r\n\r\n  try {\r\n    await user.save();\r\n    runValidators=true;\r\n    res.send(\"User Added successfully!\");\r\n  } catch (err) {\r\nif (err.code === 11000) {\r\n      return res.status(400).send(\"Email already exists\");\r\n    }\r\n    res.status(400).send(\"Error saving user: \" + err.message);\r\n  }\r\n});\r\n\r\napp.post(\"/login\",async (req,res)=>{\r\nconst {emailId,password}=req.body;\r\ntry{\r\nconst user=await User.findOne({emailId:emailId});\r\nif(!user){\r\n    throw new Error(\"Invalid Credentials\")\r\n}\r\n\r\nconst isPasswordValid=await bcrypt.compare(password,user.password);\r\nif(isPasswordValid){\r\n    //create a jwt token\r\n    const token =await jwt.sign({_id:user._id},\"DEV@Tinder$123\");\r\n\r\n    //add token to the cookie and send back the response\r\n    res.cookie(\"token\",token);\r\n    res.send(\"Login Successfull..\")\r\n}else{\r\n    throw new error(\"Invalid Credentials\")\r\n}\r\n}catch(err){\r\n    res.status(400).send(\"invalid Credentials \"+ err.message);\r\n}\r\n\r\n})\r\n\r\napp.get(\"/profile\",async (req,res)=>{\r\nconst cookies=req.cookies;\r\n\r\nconst{token}=cookies;\r\n\r\n//validate my token \r\nif(!token){\r\n    throw new Error(\"Invalid TOken\")\r\n}\r\ntry{\r\nconst decodedMessage=await jwt.verify(token,\"DEV@Tinder$123\")\r\nconst {_id}=decodedMessage;\r\nconsole.log(\"Logged In user is\"+_id);\r\nconst userId=await User.findById(_id);\r\nif(!userId){\r\n    throw new Error(\"User Does Not Exists\")\r\n}\r\nres.send(userId);\r\n}catch (err) {\r\n    res.status(400).send(\"Something went wrong \");\r\n  }\r\n})\r\n// Get user by email\r\napp.get(\"/user\", async (req, res) => {\r\n  const userEmail = req.body.emailId;\r\n\r\n  try {\r\n    console.log(userEmail);\r\n    const user = await User.findOne({ emailId: userEmail });\r\n    if (!user) {\r\n      res.status(404).send(\"User not found\");\r\n    } else {\r\n      res.send(user);\r\n    }\r\n\r\n    // const users = await User.find({ emailId: userEmail });\r\n    // if (users.length === 0) {\r\n    //   res.status(404).send(\"User not found\");\r\n    // } else {\r\n    //   res.send(users);\r\n    // }\r\n  } catch (err) {\r\n    res.status(400).send(\"Something went wrong \");\r\n  }\r\n});\r\n\r\n// Feed API - GET /feed - get all the users from the database\r\napp.get(\"/feed\", async (req, res) => {\r\n  try {\r\n    const users = await User.find({});\r\n    res.send(users);\r\n  } catch (err) {\r\n    res.status(400).send(\"Something went wrong \");\r\n  }\r\n});\r\n\r\n// Detele a user from the database\r\napp.delete(\"/user\", async (req, res) => {\r\n  const userId = req.body.userId;\r\n  try {\r\n    const user = await User.findByIdAndDelete({ _id: userId });\r\n    //const user = await User.findByIdAndDelete(userId);\r\n\r\n    res.send(\"User deleted successfully\");\r\n  } catch (err) {\r\n    res.status(400).send(\"Something went wrong \");\r\n  }\r\n});\r\n\r\n// Update data of the user\r\napp.patch(\"/user/:userId\", async (req, res) => {\r\n  const userId = req.params.userId;\r\n  const data = req.body;\r\n  try {\r\n    const ALLOWED_UPDATES=[\r\n        \"photoUrl\",\r\n        \"about\",\r\n        \"gender\",\r\n        \"skills\"\r\n    ]\r\n    const isUpdateAllowed=Object.keys(data).every((k)=> ALLOWED_UPDATES.includes(k)\r\n    );\r\n    if(!isUpdateAllowed){\r\n        throw new Error(\"Updates not allowed\");\r\n    }\r\n    if(data.skills.length>10){\r\n        throw new Error(\"skills cannot be more than 10\");\r\n    }\r\n    const user = await User.findByIdAndUpdate({ _id: userId }, data, {\r\n      returnDocument: \"after\",\r\n      runValidators: true,\r\n    });\r\n    console.log(user);\r\n    res.send(\"User updated successfully\");\r\n  } catch (err) {\r\n   \r\n    res.status(400).send(\"UPDATE FAILED:\" + err.message);\r\n  }\r\n});\r\n\r\nconnectDB()\r\n  .then(() => {\r\n    console.log(\"Database connection established...\");\r\n    app.listen(7777, () => {\r\n      console.log(\"Server is successfully listening on port 7777...\");\r\n    });\r\n  })\r\n  .catch((err) => {\r\n    console.error(\"Database cannot be connected!!\");\r\n  });"],"file":"app.dev.js"}